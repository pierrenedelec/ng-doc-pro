services:
  ng-doc-pro:
    build:
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/pierrenedelec/ng-doc-pro:latest
    container_name: ng-doc-pro
    restart: on-failure
    # Graceful shutdown timeout
    stop_grace_period: 1m
    # Port mapping (host:container)
    # HTTP: 3000 -> 80, HTTPS: 3443 -> 443
    ports:
      - 3000:80
      - 3443:443
    environment:
      - APP_HOST=ng-doc-pro
      - APP_PORT=80
      - PROXY_AUTH_ADD=false
      - TZ=UTC
    # Volume for Caddy SSL certificates persistence
    volumes:
      - caddy_data:/data/caddy
      - caddy_config:/config/caddy
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

volumes:
  caddy_data:
  caddy_config:
